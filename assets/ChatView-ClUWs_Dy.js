import{I as Q,f as X,i as y,k as Y,G as I,c as f,d as m,b as h,j as Z,v as e,l as D,F as ee,J as O,a as te,o as p}from"./vendor-Cysc0BVr.js";import{u as se,p as $}from"./index-821nrDLZ.js";import{_ as ae,a as E,C as L,b as ne}from"./ChatInput-CkNu968j.js";import"./index-kMi1dh4_.js";const oe={class:"relative flex h-[100dvh] w-full flex-col bg-gradient-to-br from-background via-background/95 to-card/50 font-sans overflow-hidden"},le={class:"flex flex-1 overflow-hidden"},re={class:"flex flex-1 flex-col"},de={class:"shrink-0"},ce={key:1,class:"flex flex-1 items-center justify-center p-4 sm:p-6"},ie={class:"w-full max-w-2xl space-y-6"},he={__name:"ChatView",setup(ue){const c=se(),{answerStreamState:g,threads:a,activeThreadId:d,inputMessage:o,connected:b,isStreaming:w,prompts:K,selectedPromptType:k,isAnalysisMode:S,messagesByActiveThread:v,currentPrompt:x,availableModels:M,inputeBoxShowState:C}=Q(c),{connectWebSocket:P,sendMessage:i,cancelStream:T,closeWebSocket:U,selectModel:F}=c,l=X(!1),A=y(()=>a.value[d.value]),W=y(()=>Object.values(a.value)),z=y(()=>{const t=v.value;return t.length?t.reduce((s,r)=>{var R;const n=((R=r.mcpcall)==null?void 0:R.length)??0;return s+(n>1?n-1:0)},0):0});function _(){l.value=!l.value}function G(t){c.switchThread(t)}function q(){c.startNewThread(),l.value=!1}function J(){A.value&&(a.value[d.value].messages=[],a.value[d.value].title="(제목 없음)",a.value[d.value].updatedAt=new Date().toISOString())}function u(t){typeof t=="object"&&t.content?(i(null,t.content,t.provider,t.model),o.value=""):typeof t=="string"?(i(null,t),o.value=""):i()}function V(t){o.value=t.replace("qqqq ",""),u(t)}function j(t){o.value=t.replace("qqqq",""),u(t)}function B(t){o.value=t.replace("qqqq",""),u(t)}function N(t){F(t)}function H(t){if(t&&typeof t=="object"){Object.keys(a.value).forEach(r=>{delete a.value[r]}),Object.assign(a.value,t);const s=Object.keys(a.value);if(s.length>0){const r=s[0];(!d.value||!a.value[d.value])&&c.switchThread(r)}console.log("✅ 스레드가 성공적으로 로드되었습니다:",t)}}return Y(()=>{Object.keys(a.value).length===0&&c.startNewThread(),P();const t=s=>{if(s.ctrlKey||s.metaKey)switch(s.key){case"n":s.preventDefault(),q();break;case"b":s.preventDefault(),_();break;case"`":s.preventDefault();break}s.key==="Escape"&&l.value&&(l.value=!1)};window.addEventListener("keydown",t),I(()=>{window.removeEventListener("keydown",t)})}),I(()=>{U()}),(t,s)=>{var r;return p(),f("div",oe,[m(ae,{connected:e(b),"message-count":e(v).length,"thread-title":(r=A.value)==null?void 0:r.title,"total-mcp-calls":z.value,"is-analysis-mode":e(S),threads:e(a),onToggleSidebar:_,onStartNewThread:q,onClearThread:J,onThreadsLoaded:H},null,8,["connected","message-count","thread-title","total-mcp-calls","is-analysis-mode","threads"]),h("div",le,[h("div",re,[e(C)?(p(),f(ee,{key:0},[m(E,{"is-streaming":e(w),messages:e(v),"current-stream-answer":e(g).currentAnswer,onResendMessage:V,onResendAnswer:j,onSendAiMessage:B},null,8,["is-streaming","messages","current-stream-answer"]),h("div",de,[m(L,{modelValue:e(o),"onUpdate:modelValue":s[0]||(s[0]=n=>O(o)?o.value=n:null),connected:e(b),"is-analysis-mode":e(S),"is-streaming":e(w),"current-prompt":e(x),"available-models":e(M),inputeBoxShowState:e(C),onSendMessage:u,onSendStockMessage:s[1]||(s[1]=n=>e(i)(e($)().prompts.stock_categories)),onCancelStream:e(T),onModelChange:N},null,8,["modelValue","connected","is-analysis-mode","is-streaming","current-prompt","available-models","inputeBoxShowState","onCancelStream"])])],64)):e(g).currentAnswer?(p(),D(E,{key:2,messages:e(v),"current-stream-answer":e(g).currentAnswer,onResendMessage:V,onResendAnswer:j,onSendAiMessage:B},null,8,["messages","current-stream-answer"])):(p(),f("div",ce,[h("div",ie,[s[7]||(s[7]=te('<div class="text-center space-y-3"><div class="mx-auto w-16 h-16 rounded-full bg-gradient-to-br from-primary/20 to-accent/20 flex items-center justify-center backdrop-blur-sm border border-border/30"><span class="text-2xl">💬</span></div><h1 class="text-xl sm:text-2xl font-bold text-foreground">AI 채팅을 시작하세요</h1><p class="text-sm text-muted-foreground max-w-md mx-auto">질문을 입력하거나 분석할 내용을 알려주세요</p></div>',1)),m(L,{modelValue:e(o),"onUpdate:modelValue":s[2]||(s[2]=n=>O(o)?o.value=n:null),connected:e(b),"is-analysis-mode":e(S),"is-streaming":e(w),"current-prompt":e(x),"available-models":e(M),onSendMessage:u,onSendStockMessage:s[3]||(s[3]=n=>e(i)(e($)().prompts.stock_categories)),onCancelStream:e(T),onModelChange:N},null,8,["modelValue","connected","is-analysis-mode","is-streaming","current-prompt","available-models","onCancelStream"])])]))])]),m(ne,{"is-open":l.value,threads:W.value,"active-thread-id":e(d),prompts:e(K),"selected-prompt-type":e(k),onClose:s[4]||(s[4]=n=>l.value=!1),onSelectThread:G,onSelectPrompt:s[5]||(s[5]=n=>k.value=n)},null,8,["is-open","threads","active-thread-id","prompts","selected-prompt-type"]),l.value?(p(),f("div",{key:0,class:"fixed inset-0 z-40 bg-black/20 backdrop-blur-sm lg:hidden",onClick:s[6]||(s[6]=n=>l.value=!1)})):Z("",!0)])}}};export{he as default};
