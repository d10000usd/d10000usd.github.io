import{r as o,k as I,w as O,a as A,o as b,b as B,d as l,n as r,t as u,h as z,e as C}from"./index-7b9fb6b1.js";const N={class:"container"},V={class:"row"},$={class:"col"},j=l("li",null,"New OHLC Data:",-1),M={class:"row"},E={class:"col"},x=1,K={__name:"PluginWebsocket_tabChart",props:{message:Object},setup(g){const i=g,d=o({types:i.message.types,ticker:i.message.ticker,candlecnt:i.message.candlecnt,timeInterval:i.message.timeInterval}),v=o([{data:[]}]),m=o({chart:{type:"candlestick",height:350,animations:{enabled:!1}},xaxis:{type:"datetime"},legend:{show:!0,position:"left"},annotations:{yaxis:Array.from({length:6},()=>({y:0,type:"numeric",borderColor:"#FF4560",label:{borderColor:"#FF4560",style:{show:!0,color:"#999",offsetX:0,offsetY:0,lineWidth:2},text:""}}))},plotOptions:{candlestick:{colors:{upward:"#FF4560",downward:"#0070FF"}}}}),t=o({candle_date_time_kst:0,opening_price:0,high_price:0,low_price:0,trade_price:0}),k=o([]),f=o([]),P=async e=>{const a=await new Response(e.data).json(),p=Math.floor(a.timestamp/(24*60*60*1e3))*(24*60*60*1e3)+9*60*60*1e3;a.code==d.value.ticker&&(S(a,p),F(),console.log("WebSocket data received:",t.value))},S=(e,a)=>{t.value={candle_date_time_kst:a,opening_price:e.opening_price,high_price:e.high_price,low_price:e.low_price,trade_price:e.trade_price},y(t.value.high_price,k),y(t.value.low_price,f),D(t.value.candle_date_time_kst,[t.value.opening_price,t.value.high_price,t.value.low_price,t.value.trade_price])},F=()=>{const e=m.value.annotations.yaxis,a=t.value;let p=1.012,h=1.01;const _=[{label:"[trate] ",y:a.trade_price*p,color:"#FFA500"},{label:"[tolerrance] ",y:a.low_price,color:"#008080"},{label:"[brate] ",y:a.trade_price*h,color:"#800080"}];e[0].lineWidth=12,e[1].lineWidth=23,e[2].lineWidth=34,e[3].lineWidth=21,e[4].lineWidth=12,e[5].lineWidth=23;for(let c=0;c<_.length;c++)e[c].y=_[c].y,e[c].label.text=_[c].label+_[c].y,e[c].borderColor=_[c].color,e[c].label.style.background=_[c].color;W(4,f),W(5,k)},T=()=>{try{const e=new WebSocket("wss://api.upbit.com/websocket/v1");e.onopen=a=>{e.send(JSON.stringify([{ticket:"test"},{type:"ticker",codes:[d.value.ticker]}])),console.error("WebSocket closed:",a)},e.onclose=a=>{console.error("WebSocket closed:",a)},e.onmessage=P}catch(e){console.error("Error fetching candle data:",e)}};I(()=>{T()});const y=(e,a)=>{e!==a.value[a.value.length-1]&&a.value.push(e),a.value.length>x&&a.value.shift()},D=(e,a)=>{v.value[0].data.length>=x&&v.value[0].data.shift(),v.value[0].data.push({x:e,y:a})},W=(e,a)=>{const p=m.value.annotations.yaxis,h=a.value[a.value.length-2];p[e].y=h,p[e].label.text=`[${e===4?"pl":"ph"}] ${h}`},w=o(t.value.trade_price),s=o(!1),n=o(!1);return O(t,()=>{t.value.trade_price>w.value?(s.value=!0,n.value=!1):t.value.trade_price<w.value&&(s.value=!1,n.value=!0),w.value=t.value.trade_price,setTimeout(()=>{s.value=!1,n.value=!1},1e3)}),(e,a)=>{const p=A("apexchart");return b(),B("div",N,[l("div",V,[l("div",$,[l("ul",null,[l("h1",{class:r({"changed-up":s.value,"changed-down":n.value})},u(d.value.ticker),3),l("li",{class:r({"changed-up":s.value,"changed-down":n.value})},"Types: "+u(d.value.types),3),l("li",{class:r({"changed-up":s.value,"changed-down":n.value})},"Candle Count: "+u(d.value.candlecnt),3),l("li",{class:r({"changed-up":s.value,"changed-down":n.value})},"Time Interval: "+u(d.value.timeInterval),3),j,l("li",{class:r({"changed-up":s.value,"changed-down":n.value})},"Candle Date Time KST: "+u(t.value.candle_date_time_kst),3),l("li",{class:r({"changed-up":s.value,"changed-down":n.value})},"Opening Price: "+u(t.value.opening_price),3),l("li",{class:r({"changed-up":s.value,"changed-down":n.value})},"High Price: "+u(t.value.high_price),3),l("li",{class:r({"changed-up":s.value,"changed-down":n.value})},"Low Price: "+u(t.value.low_price),3),l("li",{class:r({"changed-up":s.value,"changed-down":n.value})},"Trade Price: "+u(t.value.trade_price),3)])])]),l("div",M,[l("div",E,[z(p,{type:"candlestick",options:m.value,series:v.value},null,8,["options","series"])])])])}}},L={__name:"TsWebsocket",setup(g){const i=o({types:"candle",ticker:"KRW-BTC",candlecnt:123,timeInterval:"days"});return i.value.ticker,(d,v)=>(b(),C(K,{message:i.value,key:i.value},null,8,["message"]))}},J={__name:"PluginWebsocket_tabChartView",setup(g){return(i,d)=>(b(),C(L))}};export{J as default};
