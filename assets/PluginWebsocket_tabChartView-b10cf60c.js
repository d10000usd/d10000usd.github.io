import{r as l,i as I,w as N,a as O,o as h,b as k,d as o,k as j,t as p,n as m,g as F,j as z,e as S}from"./index-c453e9b2.js";const $={class:""},M={class:"row"},R={class:"col"},E={class:"container-xl"},Y=o("hr",null,null,-1),J={class:"row"},K={class:"col"},P=1,X={__name:"PluginWebsocket_tabChart",props:{message:Object},setup(y){const n=y,r=l({types:n.message.types,ticker:n.message.ticker,candlecnt:n.message.candlecnt,timeInterval:n.message.timeInterval}),t=l({candle_date_time_kst:0,opening_price:0,high_price:0,low_price:0,trade_price:0}),w=l([]),x=l([]),d=l(),T=async e=>{const a=await new Response(e.data).json();d.value=a;const c=Math.floor(a.timestamp/(24*60*60*1e3))*(24*60*60*1e3)+9*60*60*1e3;a.code==r.value.ticker&&(D(a,c),V())},v=l([{data:[]}]),b=l({chart:{type:"candlestick",height:350,animations:{enabled:!1}},xaxis:{type:"datetime"},legend:{show:!0,position:"left"},annotations:{yaxis:Array.from({length:6},()=>({y:0,type:"numeric",borderColor:"#FF4560",label:{borderColor:"#FF4560",style:{show:!0,color:"#999",offsetX:0,offsetY:0,lineWidth:2},text:""}}))},plotOptions:{candlestick:{colors:{upward:"#FF4560",downward:"#0070FF"}}}}),D=(e,a)=>{t.value={candle_date_time_kst:a,opening_price:e.opening_price,high_price:e.high_price,low_price:e.low_price,trade_price:e.trade_price},W(t.value.high_price,w),W(t.value.low_price,x),B(t.value.candle_date_time_kst,[t.value.opening_price,t.value.high_price,t.value.low_price,t.value.trade_price])},V=()=>{const e=b.value.annotations.yaxis,a=t.value;let c=1.012,g=1.01;const _=[{label:"[trate] ",y:a.trade_price*c,color:"#FFA500"},{label:"[tolerrance] ",y:a.low_price,color:"#008080"},{label:"[brate] ",y:a.trade_price*g,color:"#800080"}];e[0].lineWidth=12,e[1].lineWidth=23,e[2].lineWidth=34,e[3].lineWidth=21,e[4].lineWidth=12,e[5].lineWidth=23;for(let s=0;s<_.length;s++)e[s].y=_[s].y,e[s].label.text=_[s].label+_[s].y,e[s].borderColor=_[s].color,e[s].label.style.background=_[s].color;C(4,x),C(5,w)},A=()=>{try{const e=new WebSocket("wss://api.upbit.com/websocket/v1");e.onopen=()=>{e.send(JSON.stringify([{ticket:"test"},{type:"ticker",codes:[r.value.ticker]}]))},e.onclose=a=>{console.error("WebSocket closed:",a)},e.onmessage=T}catch(e){console.error("Error fetching candle data:",e)}};I(()=>{A()});const W=(e,a)=>{e!==a.value[a.value.length-1]&&a.value.push(e),a.value.length>P&&a.value.shift()},B=(e,a)=>{v.value[0].data.length>=P&&v.value[0].data.shift(),v.value[0].data.push({x:e,y:a})},C=(e,a)=>{const c=b.value.annotations.yaxis,g=a.value[a.value.length-2];c[e].y=g,c[e].label.text=`[${e===4?"pl":"ph"}] ${g}`},f=l(t.value.trade_price),i=l(!1),u=l(!1);return N(t,()=>{t.value.trade_price>f.value?(i.value=!0,u.value=!1):t.value.trade_price<f.value&&(i.value=!1,u.value=!0),f.value=t.value.trade_price,setTimeout(()=>{i.value=!1,u.value=!1},1e3)}),(e,a)=>{const c=O("apexchart");return h(),k("div",$,[o("div",M,[o("div",R,[o("ul",E,[Y,j(" "+p(r.value)+" ",1),o("h1",{class:m({"changed-up":i.value,"changed-down":u.value})},p(r.value.ticker),3),d.value&&d.value.signed_change_rate?(h(),k("div",{key:0,class:m({"changed-up":i.value,"changed-down":u.value})},"Types: "+p(r.value.types),3)):F("",!0),d.value&&d.value.signed_change_rate?(h(),k("div",{key:1,class:m({"changed-up":i.value,"changed-down":u.value})},"Rate: "+p(d.value.signed_change_rate*100),3)):F("",!0),o("h2",{class:m({"changed-up":i.value,"changed-down":u.value})},"Trade Price: "+p(t.value.trade_price),3)])])]),o("div",J,[o("div",K,[z(c,{type:"candlestick",options:b.value,series:v.value},null,8,["options","series"])])])])}}},q={__name:"TsWebsocket",setup(y){const n=l({types:"candle",ticker:"KRW-BTC",candlecnt:123,timeInterval:"days"});return(r,t)=>(h(),S(X,{message:n.value,key:n.value},null,8,["message"]))}},Q={__name:"PluginWebsocket_tabChartView",setup(y){return(n,r)=>(h(),S(q))}};export{Q as default};
