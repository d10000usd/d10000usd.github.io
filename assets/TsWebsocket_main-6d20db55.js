import{C as y,f as T,c as b,a as x}from"./chartOptions-fda7c86c.js";import{w as S,r as d,l as u,g as A,o as g,c as p,a as n,d as D,t as _,F as M,_ as O,e as h}from"./index-1fe36a72.js";class W{constructor(t,e,i,a,s){this.chartOptions=t,this.candleType=e,this.chartContainer=i,this.chart=null,this.ohlcdata=a,this.guidline=s}async initializeChart(){if(!this.chartContainer.value){console.error("Chart container is not defined.");return}this.clearChartContainer(),this.createChartInstance(),this.addCandlestickSeries(),this.chart.applyOptions({...this.chartOptions,grid:{vertLines:!1,horzLines:!1}}),this.addTickerTextElement();try{await this.formatedFetchAndUpdateCandle()}catch(t){console.error("Error fetching candle data:",t)}this.watchTickerChanges()}clearChartContainer(){const{children:t}=this.chartContainer.value;t.length>0&&(this.chartContainer.value.innerHTML="")}createChartInstance(){this.chart=y(this.chartContainer.value,{width:this.chartContainer.value.clientWidth,height:400}),window.addEventListener("resize",()=>{this.chart.applyOptions({width:this.chartContainer.value.clientWidth})})}addCandlestickSeries(){this.chart.addCandlestickSeries({priceLineVisible:!1,priceScale:{position:"left"}})}addTickerTextElement(){const t=document.createElement("div"),{ticker:e,candlecnt:i,timeInterval:a}=this.candleType;t.textContent=`Ticker: ${e}  ${i} ${a} `,this.chartContainer.value.appendChild(t)}watchTickerChanges(){S(()=>this.candleType.ticker,async(t,e)=>{e&&e.length>=3&&t!==e&&(this.chart.remove(),this.initializeChart())})}calculateMovingAverage(t,e){const i=[];for(let a=e-1;a<t.length;a++){const c=t.slice(a-(e-1),a+1).reduce((r,l)=>r+l.close,0)/e;i.push({time:t[a].time,value:c})}return i}async formatedFetchAndUpdateCandle(){try{const t=this.chart.addCandlestickSeries({priceLineVisible:!1,priceScale:{position:"left"}}),e=this.ohlcdata;this.updateChartWithAnalysisData(t,e),this.setAddGuidLine(t,e),this.setDataAndMarkersForStLine(t,e),t.setData(e)}catch(t){console.error("Error fetching candle data:",t)}}updateChartWithAnalysisData(t,e){this.addMovingAverages(t,e),this.addPriceLine_average(t,e),this.addPriceLine_maximum(t,e),this.addPriceLine_minimum(t,e)}addPriceLine_maximum(t,e){let i=this.chartOptions.lineOption.maxPriceLine;i.price=this.guidline.maximum.value,t.createPriceLine(i)}addPriceLine_minimum(t,e){let i=this.chartOptions.lineOption.minPriceLine;i.price=this.guidline.minimum.value,t.createPriceLine(i)}addPriceLine_average(t,e){let i=this.chartOptions.lineOption.avgPriceLine;i.price=this.guidline.average.value,t.createPriceLine(i)}setAddGuidLine(t,e){const i=[{time:this.guidline.maximum.time,value:this.guidline.maximum.value},{time:this.guidline.minimum.time,value:this.guidline.minimum.value},{time:this.guidline.average.time,value:this.guidline.average.value},{time:this.guidline.lastClose.time,value:this.guidline.lastClose.value}];this.guidline.average.time+1e-4,this.guidline.maximum.value,this.guidline.average.time+2e-4,this.guidline.minimum.value,i.sort((L,k)=>new Date(L.time).getTime()-new Date(k.time).getTime());const a=i.slice(0,2),s=i.slice(1,3),c=i.slice(-2),r=a[0].value>a[1].value?"black":"red",l=s[0].value>s[1].value?"blue":"yellow",v=c[0].value>c[1].value?"blue":"red",C=this.chart.addLineSeries({color:r,lineWidth:6}),w=this.chart.addLineSeries({color:l,lineWidth:8}),f=this.chart.addLineSeries({color:v,lineWidth:6});this.chart.addLineSeries({color:v,lineWidth:6}),C.setData(a),w.setData(s),f.setData(c)}setDataAndMarkersForStLine(t,e){t.setData(e);let i=[{time:this.guidline.maximum.time,position:"aboveBar",color:"red",shape:"arrowDown",id:"id4",text:"max @ "+this.guidline.maximum.value,size:4},{time:this.guidline.minimum.time,position:"belowBar",color:"black",shape:"arrowUp",text:"min @  "+this.guidline.minimum.value,size:4},{time:this.guidline.lastClose.time,position:"belowBar",color:"green",shape:"arrowUp",text:"클로즈 @  "+this.guidline.lastClose.value,size:4}];i.sort((a,s)=>a.time-s.time),t.setMarkers(i)}calculateMovingAverage(t,e){const i=[];for(let a=e-1;a<t.length;a++){const c=t.slice(a-(e-1),a+1).reduce((r,l)=>r+l.close,0)/e;i.push({time:t[a].time,value:c})}return i}addSMALine(t,e){this.chart.addLineSeries({color:e.color,lineWidth:e.lineWidth,priceLineVisible:e.priceLineVisible==="true"}).setData(t)}addMovingAverages(t,e){for(const[i,a]of Object.entries(this.chartOptions.movingAverages)){const s=parseInt(i.replace("ma",""),10),c=this.calculateMovingAverage(e,s);this.addSMALine(c,a)}}}const m={__name:"TsWebsocket_chart",props:{message:Object,pncounts:Object},setup(o){const t=o,e=d(t.message?{...t.message}:{}),i=u({types:e.value.type,ticker:e.value.ticker,candlecnt:e.value.candlecnt,timeInterval:e.value.timeInterval,weightValue:e.value.weightValue}),a=d(null),s=d(),c=d(),r=e.value.weightValue;return A(async()=>{s.value=await T(e.value.type,e.value.ticker,e.value.candlecnt,e.value.timeInterval),c.value=await b(s.value,r),new W(x,i,a,s.value,c.value).initializeChart()}),(l,v)=>(g(),p(M,null,[n("div",{ref_key:"chartContainer0",ref:a},null,512),D(" "+_(i),1)],64))}};const V={class:"container"},P={class:"body-full"},I={class:"spacing mb-11"},z={class:"c-custom-card"},E={class:"spacing mb-11"},B={class:"c-custom-card"},F={class:"spacing mb-11"},U={class:"c-custom-card"},$={class:"spacing mb-11"},j={class:"c-custom-card"},N={class:"spacing mb-11"},G={class:"c-custom-card"},H={__name:"TsWebsocket_main",props:["message"],setup(o){const{message:t}=o,e=a=>!a||!a.length?"KRW-BTC":a,i=u({types:"candle",ticker:e(t),candlecnt:100,timeInterval:"days",weightValue:"3.08"});return u({types:"candle",ticker:e(t),candlecnt:310,timeInterval:"weeks",weightValue:"3.05"}),u({types:"candle",ticker:e(t),candlecnt:310,timeInterval:"minute240",weightValue:"3.00"}),(a,s)=>(g(),p("div",V,[n("body",P,[n("div",I,[n("div",z,[n("h1",null,_(e(o.message)),1)])]),n("div",E,[n("div",B,[h(m,{message:i},null,8,["message"])])]),n("div",F,[n("div",U,[h(m,{message:i},null,8,["message"])])]),n("div",$,[n("div",j,[h(m,{message:i},null,8,["message"])])]),n("div",N,[n("div",G,[h(m,{message:i},null,8,["message"])])])])]))}},q=O(H,[["__scopeId","data-v-9d6113fc"]]);export{q as default};
