import{I as H,f as Q,i as w,k as X,G as Y,c as y,d as m,l as Z,v as t,F as D,J as O,b as I,o as v}from"./vendor-Cysc0BVr.js";import{u as ee,p as N}from"./index-DZsSoXU1.js";import{_ as te,a as $,C as L,b as ae}from"./ChatInput-S7jL3qNR.js";import"./index-C_7SqWYL.js";const ne={class:"relative flex size-full flex-col bg-pale-yellow-100 font-sans"},se={key:1,class:""},le={class:"flex min-h-[60vh] items-center justify-center px-3"},oe={class:"w-full max-w-md sm:max-w-xl"},me={__name:"ChatView",setup(re){const c=ee(),{answerStreamState:f,threads:n,activeThreadId:r,inputMessage:s,connected:h,isStreaming:g,prompts:E,selectedPromptType:b,isAnalysisMode:S,messagesByActiveThread:p,currentPrompt:k,availableModels:M,inputeBoxShowState:T}=H(c),{connectWebSocket:K,sendMessage:d,cancelStream:C,closeWebSocket:P,selectModel:U}=c,i=Q(!1),A=w(()=>n.value[r.value]),F=w(()=>Object.values(n.value)),W=w(()=>{const e=p.value;return e.length?e.reduce((a,o)=>{var R;const l=((R=o.mcpcall)==null?void 0:R.length)??0;return a+(l>1?l-1:0)},0):0});function _(){i.value=!i.value}function z(e){c.switchThread(e)}function q(){c.startNewThread(),i.value=!1}function G(){A.value&&(n.value[r.value].messages=[],n.value[r.value].title="(제목 없음)",n.value[r.value].updatedAt=new Date().toISOString())}function u(e){typeof e=="object"&&e.content?(d(null,e.content,e.provider,e.model),s.value=""):typeof e=="string"?(d(null,e),s.value=""):d()}function x(e){s.value=e.replace("qqqq ",""),u(e)}function B(e){s.value=e.replace("qqqq",""),u(e)}function V(e){s.value=e.replace("qqqq",""),u(e)}function j(e){U(e)}function J(e){if(e&&typeof e=="object"){Object.keys(n.value).forEach(o=>{delete n.value[o]}),Object.assign(n.value,e);const a=Object.keys(n.value);if(a.length>0){const o=a[0];(!r.value||!n.value[r.value])&&c.switchThread(o)}console.log("✅ 스레드가 성공적으로 로드되었습니다:",e)}}return X(()=>{Object.keys(n.value).length===0&&c.startNewThread(),K(),window.addEventListener("keydown",e=>{if(e.ctrlKey||e.metaKey)switch(e.key){case"n":e.preventDefault(),q();break;case"b":e.preventDefault(),_();break;case"`":e.preventDefault();break}})}),Y(()=>{P()}),(e,a)=>{var o;return v(),y("div",ne,[m(te,{connected:t(h),"message-count":t(p).length,"thread-title":(o=A.value)==null?void 0:o.title,"total-mcp-calls":W.value,"is-analysis-mode":t(S),threads:t(n),onToggleSidebar:_,onStartNewThread:q,onClearThread:G,onThreadsLoaded:J},null,8,["connected","message-count","thread-title","total-mcp-calls","is-analysis-mode","threads"]),t(T)?(v(),y(D,{key:0},[m($,{"is-streaming":t(g),messages:t(p),"current-stream-answer":t(f).currentAnswer,onResendMessage:x,onResendAnswer:B,onSendAiMessage:V},null,8,["is-streaming","messages","current-stream-answer"]),m(L,{modelValue:t(s),"onUpdate:modelValue":a[0]||(a[0]=l=>O(s)?s.value=l:null),connected:t(h),"is-analysis-mode":t(S),"is-streaming":t(g),"current-prompt":t(k),"available-models":t(M),inputeBoxShowState:t(T),onSendMessage:u,onSendStockMessage:a[1]||(a[1]=l=>t(d)(t(N)().prompts.stock_categories)),onCancelStream:t(C),onModelChange:j},null,8,["modelValue","connected","is-analysis-mode","is-streaming","current-prompt","available-models","inputeBoxShowState","onCancelStream"])],64)):t(f).currentAnswer?(v(),Z($,{key:2,messages:t(p),"current-stream-answer":t(f).currentAnswer,onResendMessage:x,onResendAnswer:B,onSendAiMessage:V},null,8,["messages","current-stream-answer"])):(v(),y("div",se,[I("div",le,[I("div",oe,[m(L,{modelValue:t(s),"onUpdate:modelValue":a[2]||(a[2]=l=>O(s)?s.value=l:null),connected:t(h),"is-analysis-mode":t(S),"is-streaming":t(g),"current-prompt":t(k),"available-models":t(M),onSendMessage:u,onSendStockMessage:a[3]||(a[3]=l=>t(d)(t(N)().prompts.stock_categories)),onCancelStream:t(C),onModelChange:j},null,8,["modelValue","connected","is-analysis-mode","is-streaming","current-prompt","available-models","onCancelStream"])])])])),m(ae,{"is-open":i.value,threads:F.value,"active-thread-id":t(r),prompts:t(E),"selected-prompt-type":t(b),onClose:a[4]||(a[4]=l=>i.value=!1),onSelectThread:z,onSelectPrompt:a[5]||(a[5]=l=>b.value=l)},null,8,["is-open","threads","active-thread-id","prompts","selected-prompt-type"])])}}};export{me as default};
