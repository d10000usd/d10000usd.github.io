import{w as _,r as d,l as u,g as b,o as C,c as w,a as l,t as p,_ as x,m as S,v as A,e as v,p as D,k as V}from"./index-233a0b32.js";import{C as M,f as I,c as W,a as O}from"./chartOptions-707b11e9.js";class P{constructor(t,e,i,a,s){this.chartOptions=t,this.candleType=e,this.chartContainer=i,this.chart=null,this.ohlcdata=a,this.guidline=s}async initializeChart(){if(!this.chartContainer.value){console.error("Chart container is not defined.");return}this.clearChartContainer(),this.createChartInstance(),this.addCandlestickSeries(),this.chart.applyOptions({...this.chartOptions,grid:{vertLines:!1,horzLines:!1},priceScale:{mode:this.candleType==="ohlc"?0:1,visible:!0}}),this.addTickerTextElement();try{await this.formatedFetchAndUpdateCandle()}catch(i){console.error("Error fetching candle data:",i)}this.watchTickerChanges();const t=this.ohlcdata[0].time,e=this.ohlcdata[this.ohlcdata.length-1].time;this.chart.timeScale().setVisibleRange({from:t,to:e})}clearChartContainer(){const{children:t}=this.chartContainer.value;t.length>0&&(this.chartContainer.value.innerHTML="")}createChartInstance(){this.chart=M(this.chartContainer.value,{width:this.chartContainer.value.clientWidth,height:400}),window.addEventListener("resize",()=>{this.chart.applyOptions({width:this.chartContainer.value.clientWidth})})}addCandlestickSeries(){this.chart.addCandlestickSeries({priceLineVisible:!1,priceScale:{position:"right"}})}addTickerTextElement(){const t=document.createElement("div"),{ticker:e,candlecnt:i,timeInterval:a}=this.candleType;t.textContent=`Ticker: ${e}  ${i} ${a} `,this.chartContainer.value.appendChild(t)}watchTickerChanges(){_(()=>this.candleType.ticker,async(t,e)=>{e&&e.length>=3&&t!==e&&(this.chart.remove(),this.initializeChart())})}calculateMovingAverage(t,e){const i=[];for(let a=e-1;a<t.length;a++){const c=t.slice(a-(e-1),a+1).reduce((r,n)=>r+n.close,0)/e;i.push({time:t[a].time,value:c})}return i}async formatedFetchAndUpdateCandle(){try{const t=this.chart.addCandlestickSeries({priceLineVisible:!1,priceScale:{position:"left"}}),e=this.ohlcdata;this.updateChartWithAnalysisData(t,e),this.setAddGuidLine(t,e),this.setDataAndMarkersForStLine(t,e),t.setData(e)}catch(t){console.error("Error fetching candle data:",t)}}updateChartWithAnalysisData(t,e){this.addMovingAverages(t,e),this.addPriceLine_average(t,e),this.addPriceLine_maximum(t,e),this.addPriceLine_minimum(t,e)}addPriceLine_maximum(t,e){let i=this.chartOptions.lineOption.maxPriceLine;i.price=this.guidline.maximum.value,t.createPriceLine(i)}addPriceLine_minimum(t,e){let i=this.chartOptions.lineOption.minPriceLine;i.price=this.guidline.minimum.value,t.createPriceLine(i)}addPriceLine_average(t,e){let i=this.chartOptions.lineOption.avgPriceLine;i.price=this.guidline.average.value,t.createPriceLine(i)}setAddGuidLine(t,e){const i=[{time:this.guidline.maximum.time,value:this.guidline.maximum.value},{time:this.guidline.minimum.time,value:this.guidline.minimum.value},{time:this.guidline.average.time,value:this.guidline.average.value},{time:this.guidline.lastClose.time,value:this.guidline.lastClose.value}];this.guidline.average.time+1e-4,this.guidline.maximum.value,this.guidline.average.time+2e-4,this.guidline.minimum.value,i.sort((y,T)=>new Date(y.time).getTime()-new Date(T.time).getTime());const a=i.slice(0,2),s=i.slice(1,3),c=i.slice(-2),r=a[0].value>a[1].value?"black":"red",n=s[0].value>s[1].value?"blue":"yellow",h=c[0].value>c[1].value?"blue":"red",m=this.chart.addLineSeries({color:r,lineWidth:6}),L=this.chart.addLineSeries({color:n,lineWidth:8}),k=this.chart.addLineSeries({color:h,lineWidth:6});this.chart.addLineSeries({color:h,lineWidth:6}),m.setData(a),L.setData(s),k.setData(c)}setDataAndMarkersForStLine(t,e){t.setData(e);let i=[{time:this.guidline.maximum.time,position:"aboveBar",color:"red",shape:"arrowDown",id:"id4",text:"max @ "+this.guidline.maximum.value,size:4},{time:this.guidline.minimum.time,position:"belowBar",color:"black",shape:"arrowUp",text:"min @  "+this.guidline.minimum.value,size:4},{time:this.guidline.lastClose.time,position:"belowBar",color:"green",shape:"arrowUp",text:"클로즈 @  "+this.guidline.lastClose.value,size:4}];i.sort((a,s)=>a.time-s.time),t.setMarkers(i)}calculateMovingAverage(t,e){const i=[];for(let a=e-1;a<t.length;a++){const c=t.slice(a-(e-1),a+1).reduce((r,n)=>r+n.close,0)/e;i.push({time:t[a].time,value:c})}return i}addSMALine(t,e){this.chart.addLineSeries({color:e.color,lineWidth:e.lineWidth,priceLineVisible:e.priceLineVisible==="true"}).setData(t)}addMovingAverages(t,e){for(const[i,a]of Object.entries(this.chartOptions.movingAverages)){const s=parseInt(i.replace("ma",""),10),c=this.calculateMovingAverage(e,s);this.addSMALine(c,a)}}}const z={class:"c-custom-card"},E=l("div",{class:"spacing mb-21"},null,-1),B=[E],g={__name:"TsWebsocket_chart",props:{message:Object,pncounts:Number},setup(o){const t=o,e=d(t.message?{...t.message}:{}),i=u({types:e.value.type,ticker:e.value.ticker,candlecnt:e.value.candlecnt,timeInterval:e.value.timeInterval,weightValue:e.value.weightValue}),a=d(null),s=d(),c=d(),r=e.value.weightValue;return b(async()=>{s.value=await I(e.value.type,e.value.ticker,e.value.candlecnt,e.value.timeInterval),c.value=await W(s.value,r),new P(O,i,a,s.value,c.value).initializeChart()}),(n,h)=>(C(),w("div",z,[l("h3",null,p(i),1),l("div",{ref_key:"chartContainer0",ref:a},B,512)]))}};const f=o=>(D("data-v-31e5da92"),o=o(),V(),o),$={class:"container body-full"},F={class:"c-custom-card"},U={class:"mx-3 badge bg-secondary"},N={class:"spacing"},j=f(()=>l("div",{class:"spacing"},null,-1)),G={class:"spacing"},R=f(()=>l("div",{class:"spacing"},null,-1)),H={class:"spacing"},K={__name:"TsWebsocket_main",props:["message"],setup(o){const{message:t}=o,e=d(3),i=n=>{const h=n.target.value;e.value=h};_(e,n=>{s.weightValue=n,c.weightValue=n,r.weightValue=n});const a=n=>!n||!n.length?"KRW-BTC":n,s=u({types:"candle",ticker:a(t),candlecnt:100,timeInterval:"days",weightValue:3.41}),c=u({types:"candle",ticker:a(t),candlecnt:310,timeInterval:"weeks",weightValue:3.2}),r=u({types:"candle",ticker:a(t),candlecnt:310,timeInterval:"minute240",weightValue:3});return(n,h)=>(C(),w("body",$,[l("div",null,[l("h1",F,p(a(o.message)),1)]),S(l("input",{type:"range",min:"3",max:"3.6",step:"0.01","onUpdate:modelValue":h[0]||(h[0]=m=>e.value=m),onInput:i,class:"form-range",style:{width:"100%"}},null,544),[[A,e.value]]),l("span",U,p(e.value),1),l("div",N,[v(g,{message:s,pncounts:e.value},null,8,["message","pncounts"])]),j,l("div",G,[v(g,{message:c,pncounts:e.value},null,8,["message","pncounts"])]),R,l("div",H,[v(g,{message:r,pncounts:e.value},null,8,["message","pncounts"])])]))}},Q=x(K,[["__scopeId","data-v-31e5da92"]]);export{Q as default};
