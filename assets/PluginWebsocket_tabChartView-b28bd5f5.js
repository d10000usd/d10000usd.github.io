import{g as O}from"./GetImageUrl-de842c6f.js";import{r as n,c as V,a as $,o as _,e as D,f as j,d as s,g as w,i as A,w as z,b as v,n as y,t as k,j as x,q as M,F as q}from"./index-797d7bd8.js";import E from"./StaticView-964af3cc.js";import"./PluginMarkdownPaser-c1dbe370.js";import"./javascript-5c9af692.js";const L=["src"],Y={__name:"RouteButton",props:{message:Object},setup(h){const r=h.message,a=n({apisend:r}),m=V(()=>`https://raw.githubusercontent.com/d10000usd/WebDocuments/main/public/icon/space/workspace-vector-free-icon-set-${O(12,40)}.png`);return(g,l)=>{const W=$("RouterLink");return a.value.apisend?(_(),D(W,{class:"navbar-brand",to:{path:"/Body_view",query:{apisend:a.value.apisend}},key:a.value.receivedRouteName},{default:j(()=>[s("img",{src:m.value,class:"card-img-top",alt:"Image"},null,8,L)]),_:1},8,["to"])):w("",!0)}}};const J={class:""},K=s("div",{class:"col-12"},null,-1),U={class:"row"},X={class:"col"},G={class:"container-xl"},Q=s("hr",null,null,-1),Z={class:"row"},H={class:"col"},ee=s("br",null,null,-1),te=s("br",null,null,-1),ae=s("hr",null,null,-1),S=1,se={__name:"PluginWebsocket_tabChart",props:{message:Object},setup(h){const c=h,r=n({types:c.message.types,ticker:c.message.ticker,candlecnt:c.message.candlecnt,timeInterval:c.message.timeInterval}),a=n({candle_date_time_kst:0,opening_price:0,high_price:0,low_price:0,trade_price:0}),m=n([]),g=n([]),l=n(),W=async e=>{const t=await new Response(e.data).json();l.value=t;const i=Math.floor(t.timestamp/(24*60*60*1e3))*(24*60*60*1e3)+9*60*60*1e3;t.code==r.value.ticker&&(R(t,i),T())},b=n([{data:[]}]),C=n({chart:{type:"candlestick",height:350,animations:{enabled:!1}},xaxis:{type:"datetime"},legend:{show:!0,position:"left"},annotations:{yaxis:Array.from({length:6},()=>({y:0,type:"numeric",borderColor:"#FF4560",label:{borderColor:"#FF4560",style:{show:!0,color:"#999",offsetX:0,offsetY:0,lineWidth:2},text:""}}))},plotOptions:{candlestick:{colors:{upward:"#FF4560",downward:"#0070FF"}}}}),R=(e,t)=>{a.value={candle_date_time_kst:t,opening_price:e.opening_price,high_price:e.high_price,low_price:e.low_price,trade_price:e.trade_price},P(a.value.high_price,m),P(a.value.low_price,g),I(a.value.candle_date_time_kst,[a.value.opening_price,a.value.high_price,a.value.low_price,a.value.trade_price])},T=()=>{const e=C.value.annotations.yaxis,t=a.value;let i=1.012,f=1.01;const p=[{label:"[trate] ",y:t.trade_price*i,color:"#FFA500"},{label:"[tolerrance] ",y:t.low_price,color:"#008080"},{label:"[brate] ",y:t.trade_price*f,color:"#800080"}];e[0].lineWidth=12,e[1].lineWidth=23,e[2].lineWidth=34,e[3].lineWidth=21,e[4].lineWidth=12,e[5].lineWidth=23;for(let o=0;o<p.length;o++)e[o].y=p[o].y,e[o].label.text=p[o].label+p[o].y,e[o].borderColor=p[o].color,e[o].label.style.background=p[o].color;N(4,g),N(5,m)},B=()=>{try{const e=new WebSocket("wss://api.upbit.com/websocket/v1");e.onopen=()=>{e.send(JSON.stringify([{ticket:"test"},{type:"ticker",codes:[r.value.ticker]}]))},e.onclose=t=>{console.error("WebSocket closed:",t)},e.onmessage=W}catch(e){console.error("Error fetching candle data:",e)}};A(()=>{B()});const P=(e,t)=>{e!==t.value[t.value.length-1]&&t.value.push(e),t.value.length>S&&t.value.shift()},I=(e,t)=>{b.value[0].data.length>=S&&b.value[0].data.shift(),b.value[0].data.push({x:e,y:t})},N=(e,t)=>{const i=C.value.annotations.yaxis,f=t.value[t.value.length-2];i[e].y=f,i[e].label.text=`[${e===4?"pl":"ph"}] ${f}`},F=n(a.value.trade_price),u=n(!1),d=n(!1);return z(a,()=>{a.value.trade_price>F.value?(u.value=!0,d.value=!1):a.value.trade_price<F.value&&(u.value=!1,d.value=!0),F.value=a.value.trade_price,setTimeout(()=>{u.value=!1,d.value=!1},1e3)}),(e,t)=>{const i=$("apexchart");return _(),v(q,null,[s("div",J,[K,s("div",U,[s("div",X,[s("ul",G,[Q,s("h1",{class:y({"changed-up":u.value,"changed-down":d.value})},k(r.value.ticker),3),l.value&&l.value.signed_change_rate?(_(),v("div",{key:0,class:y({"changed-up":u.value,"changed-down":d.value})},"Types: "+k(r.value.types),3)):w("",!0),l.value&&l.value.signed_change_rate?(_(),v("div",{key:1,class:y({"changed-up":u.value,"changed-down":d.value})},"Rate: "+k(l.value.signed_change_rate*100),3)):w("",!0),l.value&&l.value.signed_change_rate?(_(),v("div",{key:2,class:y({"changed-up":u.value,"changed-down":d.value})},"Trade Price: "+k(a.value.trade_price),3)):w("",!0)])])]),s("div",Z,[s("div",H,[x(i,{type:"candlestick",options:C.value,series:b.value},null,8,["options","series"])])])]),ee,te,ae,x(E),M("> "),x(Y,{message:3})],64)}}},ne={__name:"TsWebsocket",setup(h){const c=n({types:"candle",ticker:"KRW-BTC",candlecnt:123,timeInterval:"days"});return(r,a)=>(_(),D(se,{message:c.value,key:c.value},null,8,["message"]))}},oe={class:"container"},_e={__name:"PluginWebsocket_tabChartView",setup(h){return(c,r)=>(_(),v("div",oe,[x(ne)]))}};export{_e as default};
